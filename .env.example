# üåç Archivo de Variables - .env.example
# ====================================
# Configuraci√≥n centralizada para RKE2 + Rancher HA Installer v2.0
# Copia este archivo como .env y modifica los valores seg√∫n tu entorno

# üîê CONFIGURACI√ìN DE ACCESO SSH
# ==============================
# Contrase√±a SSH unificada para todos los nodos (OBLIGATORIO)
ROOT_PASSWORD=TuPasswordSeguraAqui

# Puerto SSH utilizado por los nodos (por defecto 22)
SSH_PORT=22

# Usuario SSH (por defecto root, puede ser sudo user)
SSH_USER=root

# üåê CONFIGURACI√ìN DE RED Y DOMINIO
# =================================
# IP del LoadBalancer externo (NGINX Plus o similar)
# Esta IP debe ser accesible desde internet/red interna
LB_IP=1.1.1.1

# Dominio asignado a Rancher (debe estar configurado en DNS o /etc/hosts)
# IMPORTANTE: Debe resolver a LB_IP antes de ejecutar scripts
RANCHER_DOMAIN=rancher.midominio.com

# Rango de IPs libres en tu red para MetalLB LoadBalancer
# Formato: IP_INICIO-IP_FIN (deben estar libres en tu red)
METALLB_IP_RANGE=1.1.1.200-1.1.1.210

# üîë CONFIGURACI√ìN DE SEGURIDAD
# =============================
# Contrase√±a inicial para Rancher UI (bootstrap admin user)
# M√≠nimo 8 caracteres, se recomienda incluir n√∫meros y s√≠mbolos
BOOTSTRAP_PASSWORD=AdminPassword123!

# Token √∫nico para el cl√∫ster RKE2 (genera uno aleatorio seguro)
# Se usa para autenticaci√≥n entre nodos del cl√∫ster
CLUSTER_TOKEN=MiSuperTokenSeguro123XYZ789

# üì¶ VERSIONES DE SOFTWARE
# ========================
# Versi√≥n exacta de RKE2 a instalar
# Ver versiones disponibles en: https://github.com/rancher/rke2/releases
RKE2_VERSION=v1.32.1+rke2r1

# Versi√≥n exacta de Rancher a instalar  
# Ver versiones disponibles en: https://github.com/rancher/rancher/releases
RANCHER_VERSION=v2.11.1

# üèóÔ∏è CONFIGURACI√ìN DIN√ÅMICA DE NODOS (JSON)
# ==========================================
# NUEVA CARACTER√çSTICA v2.0: Configuraci√≥n centralizada de todos los nodos
# 
# Formato JSON: {"hostname": {"ip": "x.x.x.x", "type": "master|worker|storage", "primary": true/false}}
#
# Tipos de nodos:
# - master: Control plane (etcd, API server, scheduler, controller-manager)
# - worker: Nodos de aplicaci√≥n (donde se despliega Rancher UI y workloads)
# - storage: Nodos de almacenamiento (Ceph OSDs, almacenamiento persistente)
#
# Configuraci√≥n primary:
# - Solo UN nodo master debe tener "primary": true (donde se ejecuta instalaci√≥n inicial)
# - Todos los dem√°s nodos deben tener "primary": false
#
# IMPORTANTE: Modifica hostnames e IPs seg√∫n tu infraestructura
NODES_CONFIG='{
  "prd3appk8sm1": {"ip": "1.1.1.20", "type": "master", "primary": true},
  "prd3appk8sm2": {"ip": "1.1.1.21", "type": "master", "primary": false},
  "prd3appk8sm3": {"ip": "1.1.1.22", "type": "master", "primary": false},
  "prd3appk8sw1": {"ip": "1.1.1.30", "type": "worker", "primary": false},
  "prd3appk8sw2": {"ip": "1.1.1.31", "type": "worker", "primary": false},
  "prd3appk8sw3": {"ip": "1.1.1.32", "type": "worker", "primary": false},
  "prd3appk8ss1": {"ip": "1.1.1.40", "type": "storage", "primary": false},
  "prd3appk8ss2": {"ip": "1.1.1.41", "type": "storage", "primary": false},
  "prd3appk8ss3": {"ip": "1.1.1.42", "type": "storage", "primary": false}
}'

# üìã EJEMPLOS DE CONFIGURACIONES ALTERNATIVAS
# ===========================================

# Ejemplo 1: Cl√∫ster peque√±o (3 nodos todo-en-uno)
# NODES_CONFIG='{
#   "k8s-node1": {"ip": "192.168.1.10", "type": "master", "primary": true},
#   "k8s-node2": {"ip": "192.168.1.11", "type": "master", "primary": false},
#   "k8s-node3": {"ip": "192.168.1.12", "type": "master", "primary": false}
# }'

# Ejemplo 2: Cl√∫ster medio (1 master + 2 workers, sin storage dedicado)
# NODES_CONFIG='{
#   "master-1": {"ip": "10.0.1.10", "type": "master", "primary": true},
#   "worker-1": {"ip": "10.0.1.20", "type": "worker", "primary": false},
#   "worker-2": {"ip": "10.0.1.21", "type": "worker", "primary": false}
# }'

# Ejemplo 3: Cl√∫ster grande (5 masters + 10 workers + 6 storage)
# NODES_CONFIG='{
#   "master-1": {"ip": "10.0.1.10", "type": "master", "primary": true},
#   "master-2": {"ip": "10.0.1.11", "type": "master", "primary": false},
#   "master-3": {"ip": "10.0.1.12", "type": "master", "primary": false},
#   "master-4": {"ip": "10.0.1.13", "type": "master", "primary": false},
#   "master-5": {"ip": "10.0.1.14", "type": "master", "primary": false},
#   "worker-1": {"ip": "10.0.2.10", "type": "worker", "primary": false},
#   "worker-2": {"ip": "10.0.2.11", "type": "worker", "primary": false},
#   ...
#   "storage-1": {"ip": "10.0.3.10", "type": "storage", "primary": false},
#   "storage-2": {"ip": "10.0.3.11", "type": "storage", "primary": false},
#   ...
# }'

# üîß CONFIGURACIONES OPCIONALES AVANZADAS
# =======================================

# Email para certificados Let's Encrypt (opcional)
# LETSENCRYPT_EMAIL=admin@midominio.com

# Configuraci√≥n de timezone para el cl√∫ster (opcional)
# CLUSTER_TIMEZONE=America/Lima

# Configuraci√≥n de DNS servers para el cl√∫ster (opcional)
# CLUSTER_DNS_SERVERS=8.8.8.8,8.8.4.4

# Configuraci√≥n de proxy HTTP/HTTPS (opcional, para entornos corporativos)
# HTTP_PROXY=http://proxy.empresa.com:8080
# HTTPS_PROXY=http://proxy.empresa.com:8080
# NO_PROXY=localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16

# Configuraci√≥n de registry privado (opcional)
# PRIVATE_REGISTRY=registry.empresa.com
# REGISTRY_USER=usuario
# REGISTRY_PASSWORD=password

# üìù NOTAS IMPORTANTES
# ===================
# 
# 1. VALIDACI√ìN JSON:
#    Antes de usar, valida tu JSON con: echo "$NODES_CONFIG" | jq .
# 
# 2. PREREQUISITOS POR TIPO DE NODO:
#    - Todos: Oracle Linux 8+, 4GB RAM, SSH accesible
#    - Storage: Disco /dev/sdb disponible y sin montar
#    - Master: M√≠nimo 2 CPUs, acceso a puertos 6443/9345
#    - Worker: Acceso a puertos 80/443 desde LoadBalancer
# 
# 3. RED Y CONECTIVIDAD:
#    - Todos los nodos deben poder comunicarse entre s√≠
#    - RANCHER_DOMAIN debe resolver a LB_IP
#    - METALLB_IP_RANGE debe estar libre en tu red
#    - Firewall debe permitir tr√°fico entre nodos
# 
# 4. ESCALABILIDAD:
#    Para agregar/quitar nodos, simplemente modifica NODES_CONFIG
#    y re-ejecuta los scripts relevantes (01-setup-ssh.sh, 02-install-cluster.sh)
# 
# 5. BACKUP:
#    Respalda este archivo .env despu√©s de configurarlo
#    Es la configuraci√≥n maestra de toda tu infraestructura
# 
# 6. SEGURIDAD:
#    - Usa passwords seguros (ROOT_PASSWORD, BOOTSTRAP_PASSWORD, CLUSTER_TOKEN)
#    - No compartas este archivo en repositorios p√∫blicos
#    - Cambia las contrase√±as por defecto despu√©s de la instalaci√≥n

# üöÄ PARA EMPEZAR:
# ===============
# 1. Copia este archivo: cp .env.example .env
# 2. Modifica las variables seg√∫n tu entorno
# 3. Valida la configuraci√≥n: bash scripts/00-check-prereqs.sh
# 4. Ejecuta la instalaci√≥n: ./install-all.sh full

# üìö DOCUMENTACI√ìN:
# ================
# - README.md: Gu√≠a de instalaci√≥n completa
# - docs/index.md: Documentaci√≥n t√©cnica detallada  
# - docs/nginx-plus.md: Configuraci√≥n de LoadBalancer externo
